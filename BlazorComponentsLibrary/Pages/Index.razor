@page "/"
@using IWorkTooMuch.Blazor.Components.Interfaces
@using Model

<div class="wrapper">

    <div style="width:400px">
        <InputLabel Title="Multiselect box">
            <Multiselect Entities="entities" />
        </InputLabel>
    </div>

    <SelectEntityListed Title="Static List Select" Suggestions="entities" T="IEntity" />

    <SelectEntitySuggested Title="Suggested Select" MinLengthForSuggestions="3" @bind-Suggestions="suggestions" OnEnterPressed="ProvideSuggestions" T="IEntity" />

    <div style="width: max-content;">

        <InputLabel Title="Message Text">
            <input @bind-value="input" />
        </InputLabel>

        <div class="btnbox">
            <button class="btn btn-primary" @onclick="() => Notify(1)">Test Default</button>
            <button class="btn btn-success" @onclick="() => Notify(2)">Test Success</button>
            <button class="btn btn-warning" @onclick="() => Notify(3)">Test Warning</button>
            <button class="btn btn-danger" @onclick="() => Notify(4)">Test Danger</button>
        </div>

    </div>

</div>
@code{

    [CascadingParameter]
    public Notifier Notifier { get; set; }

    public string input { get; set; }

    private void Notify(int num)
    {
        switch (num)
        {
            case 1:
                Notifier.ProcessNotification("Default", input);
                break;
            case 2:
                Notifier.ProcessSuccess("Succcess", input);
                break;
            case 3:
                Notifier.ProcessWarning("Warning", input);
                break;
            case 4:
                Notifier.ProcessError(new Exception(input));
                break;
        }
    }

    private List<IEntity> entities;

    private List<IEntity> suggestions;

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(2000);

        entities = new();

        for (int i = 0; i < 25; i++)
            entities.Add(new Entity()
            {
                Id = i,
                Name = $"entity {i}"
            });
    }

    private async Task ProvideSuggestions(string search)
    {
        int totalOptions = 10000;

        int mySuggestions = totalOptions / (search.Length * 2);

        if (mySuggestions > 1000)
        {
            Notifier.ProcessError(new Exception("More than 1000 suggestions found; please narrow search"));
            suggestions = new();
            return;
        }

        await Task.Delay(3000);

        suggestions = new();

        for (int i = 0; i < mySuggestions; i++)
            suggestions.Add(new Entity()
            {
                Id = i,
                Name = $"entity {i}"
            });
    }

}